<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Lovely's Secret Santa Picker</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <h1>🎄 The Lovely's Secret Santa Picker 🎅</h1>

    <div id="setup">
        <h2>Enter Names</h2>
        <div id="nameInputs">
            <!-- Default input box -->
            <input type="text" class="nameBox" placeholder="Enter name" />
            <input type="text" class="nameBox" placeholder="Enter name" />
            <input type="text" class="nameBox" placeholder="Enter name" />
            <input type="text" class="nameBox" placeholder="Enter name" />
            <input type="text" class="nameBox" placeholder="Enter name" />
        </div>
        <button onclick="addNameBox()">Add More Names</button><br><br>
        <button onclick="createAssignments()">Generate Secret Santa Assignments</button>
        <div id="message"></div>
    </div>

    <div id="reveal">
        <h2>Retrieve Your Secret Santa</h2>
        <input type="text" id="codeInput" placeholder="Enter your code">
        <button onclick="revealAssignment()">Reveal Secret Santa</button>
        <div id="result"></div>
    </div>

    <script>
        // Add input boxes for more names
        function addNameBox() {
            const nameInputs = document.getElementById("nameInputs");
            const newInput = document.createElement("input");
            newInput.type = "text";
            newInput.className = "nameBox";
            newInput.placeholder = "Enter name";
            nameInputs.appendChild(newInput);
        }

        // Generate the assignments
        async function createAssignments() {
            const nameBoxes = document.querySelectorAll('.nameBox');
            const names = Array.from(nameBoxes).map(input => input.value.trim()).filter(name => name);

            const response = await fetch('/create-assignments', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ names })
            });

            const data = await response.json();
            const messageElement = document.getElementById('message');

            if (response.ok) {
                // Display codes for each giver
                let codesText = 'Assignments created! Here are your codes (keep them private):\n';
                data.codes.forEach(item => {
                    codesText += `${item.giver}: ${item.code}\n`;
                });
                messageElement.innerText = codesText;
            } else {
                messageElement.innerText = data.error;
            }
        }

        // Reveal the assignment for a given code
        async function revealAssignment() {
            const code = document.getElementById('codeInput').value.trim();
            const response = await fetch(`/assignment/${code}`);
            const data = await response.json();

            if (response.ok) {
                document.getElementById('result').innerText = `🎁 ${data.giver}, you are giving a gift to: ${data.recipient}`;
            } else {
                document.getElementById('result').innerText = 'Invalid code. Please try again.';
            }
        }
    </script>
</body>
</html>
